<% doc_presenter = show_presenter(document) %>
<%# default partial to display solr document fields in catalog show view -%>
<small class="h5 pl-4 text-muted"><%= document["display_date"] %></small>

<div class="row">
	<% if document["file"].present? %>
		<div class="col-lg-6 order-lg-2">
			<% if document.key? "representative_media" %>
				<% manifest = transform_url(document['representative_media']) %>
			<% elsif document["citation_links"].present? %>
				<% manifest = transform_url(document["citation_links"][0]) %>
			<% end %>
			<% if document["citation_pages"].present? %>
				<% page = document["citation_pages"][0].to_i %>
			<% else %>
				<% page = 0 %>
			<% end %>
			
			<% if manifest %>
				<div class="d-flex justify-content-end mt-2">
					<a href="https://media.archives.albany.edu?manifest=<%= manifest %>" class="fullscreen-btn btn btn-secondary btn-sm mb-2">
				      <i class="fa fa-expand me-1"></i> Fullscreen
				    </a>
				</div>

				<div id="mirador-viewer"></div>
				<%= javascript_include_tag "https://media.archives.albany.edu/mirador.min.js" %>
				<script>
				  document.addEventListener("DOMContentLoaded", function () {
				  	const isMobile = window.innerWidth <= 768;
				    Mirador.viewer({
				      id: "mirador-viewer",
				      windows: [{
				        loadedManifest: "<%= manifest %>",
				        canvasIndex: <%= page - 1 %>,
				        allowFullscreen: true,
				        zoomControls: true,
				        thumbnailNavigationPosition: isMobile ? 'off' : 'far-bottom',
				      }],
				      workspace: {
						  showZoomControls: true,
					  },
				      requestConfig: {
				        credentials: 'include',
				      },
				      workspaceControlPanel: { enabled: false },
				      themes: {
				        light: {
				          palette: {
				            primary: {
				              main: '#46166B'
				            }
				          }
				        }
				      },
				      window: {
				        allowClose: false,
				        showZoomControls: true,
				        sideBarOpenByDefault: false
				      },
				      miradorSharePlugin: {
						embedOption: {
							enabled: true,
							embedUrlReplacePattern: [/^/, 'https://media.archives.albany.edu/?manifest=']
						},
						shareLink: {
							enabled: true,
							manifestIdReplacePattern: [/^/, 'https://media.archives.albany.edu/?manifest=']
						}
					  }
				    });
				  });
				</script>
			<% end %>
		</div>
		<div class="col-lg-6 order-lg-1">
	<% else %>
		<div class="col-lg-12 order-lg-1">
	<% end %>
        
		
			<div class="card-body">
				<% if document["file"].present? %>
					<p class="card-text"><%= document["description"] %></p>
				<% else %>
					<p class="card-text"><%= CGI.unescapeHTML(document["description"]).html_safe %></p>
				<% end %>
          	</div>

	        <% if document["subjects"].present? %>
	            <div class="card-body">
	              <h2 class="h4">Subjects</h2>
	              <ul class="list-group mb-3">
	                <% document["subjects"].sort.each do |subject| %>
	                  <a href="/history/catalog?f[subjects][]=<%= CGI.escape subject %>" class="list-group-item list-group-item-action list-group-item-info"><%= subject %></a>
	                <% end %>
	              </ul>
	            </div>
	        <% end %>

	        <% if document["citation_description"].present? %>
	            <div class="card-body">
	                <h2 class="h4">Source Details</h2>
	                <p class="card-text"><%= CGI.unescapeHTML(document["citation_description"]).html_safe %></p>
	            </div>
	        <% end %>

	        <% if document["citation_files"].present? %>
	            <div class="card-body container">
	              
	              <h2 class="h4">Source Materials</h2>
	              <div class="row">
	                <% files = Array(document["citation_files"]) %>
					<% pages = Array(document["citation_pages"]) %>

					<% document["citation_links"].each_with_index do |cite, index| %>
					  <div class="col-md-6 col-sm-12 d-flex pb-3">
					    <div class="card" style="width: 18rem; display:block">

					      <img height="150px"
					           style="display:block;margin: auto;"
					           src="<%= files[index] %>"
					           alt="Thumbnail for <%= document['citation_text'][index] %>">

					      <div class="card-body">
					        <% if pages[index].present? %>
					          <a href="<%= cite %>?page=<%= pages[index] %>"
					             class="card-link">
					            <%= document["citation_text"][index] %>
					          </a>
					        <% else %>
					          <a href="<%= cite %>"
					             class="card-link">
					            <%= CGI.unescapeHTML(document["citation_text"][index]).html_safe %>
					          </a>
					        <% end %>
					      </div>

					    </div>
					  </div>
					<% end %>
	              </div>

	            </div>
			<% end %>

		</div>
		<div class="col-12 order-lg-3">
		<a href="https://process.archives.albany.edu/history-editor/events/<%= document["id"] %>/edit" type="button" class="btn btn-light mt-2 float-right">Edit</a>
	</div>
	
</div>
